<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Place Order - Food Ordering System</title>
  <style>
    body{font-family:Arial, sans-serif;background:#f7f7f7;margin:0;padding:20px}
    .container{max-width:900px;margin:30px auto;background:#fff;padding:24px;border-radius:10px;box-shadow:0 3px 18px rgba(0,0,0,.06)}
    h1{margin:0 0 18px;font-size:28px}
    table{width:100%;border-collapse:collapse;margin-bottom:18px}
    th,td{padding:12px 10px;text-align:left;border-bottom:1px solid #eee}
    .price{color:green;font-weight:700}
    .controls{display:flex;gap:12px;align-items:center}
    .btn{background:orange;color:#fff;border:none;padding:12px 18px;border-radius:8px;cursor:pointer;font-size:16px}
    .btn.secondary{background:#e9ecef;color:#111}
    .small{font-size:14px;color:#666}
    .trash{background:#ff6b6b;border:none;color:#fff;padding:6px 10px;border-radius:6px;cursor:pointer}
    .center{display:flex;justify-content:space-between;align-items:center}
    @media(max-width:600px){.controls{flex-direction:column;align-items:stretch}}
  </style>
</head>
<body>
  <div class="container">
    <div class="center">
      <h1>Order Summary</h1>
      <div>
        <button class="btn secondary" onclick="goBack()">Back to Menu</button>
      </div>
    </div>

    <div id="empty-msg" class="small">Loading cart...</div>

    <table id="order-table" style="display:none">
      <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="order-body"></tbody>
      <tfoot>
        <tr>
          <td colspan="3" style="text-align:right;padding-top:12px"><strong>Total:</strong></td>
          <td colspan="2" style="padding-top:12px"><strong id="total-amt" class="price">₹0</strong></td>
        </tr>
      </tfoot>
    </table>

    <div class="controls">
      <button class="btn" id="place-order-btn" onclick="placeOrder()">Place Order</button>
      <button class="btn secondary" onclick="clearCart()">Clear Cart</button>
    </div>
  </div>

  <script>
    // Read cart from localStorage (expected format: [{name, cost, qty}] )
    const CART_KEY = 'food_cart';

    function loadCart(){
      const raw = localStorage.getItem(CART_KEY);
      return raw ? JSON.parse(raw) : [];
    }

    function saveCart(cart){
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }

    function renderCart(){
      const cart = loadCart();
      const tbody = document.getElementById('order-body');
      const tbl = document.getElementById('order-table');
      const empty = document.getElementById('empty-msg');
      tbody.innerHTML = '';
      if(cart.length===0){
        tbl.style.display='none';
        empty.style.display='block';
        empty.innerText = 'No items in cart. Please add items from the menu.';
        document.getElementById('place-order-btn').disabled = true;
        return;
      }
      tbl.style.display='table';
      empty.style.display='none';
      let total = 0;
      cart.forEach((it, idx) => {
        const qty = it.qty || 1;
        const subtotal = qty * parseFloat(it.cost);
        total += subtotal;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${it.name}</td>
          <td>
            <input type="number" min="1" value="${qty}" style="width:60px" onchange="updateQty(${idx},this.value)">
          </td>
          <td>₹${it.cost}</td>
          <td>₹${subtotal.toFixed(2)}</td>
          <td><button class="trash" onclick="removeItem(${idx})">Remove</button></td>
        `;
        tbody.appendChild(tr);
      });
      document.getElementById('total-amt').innerText = '₹' + total.toFixed(2);
      document.getElementById('place-order-btn').disabled = false;
    }

    function updateQty(i, val){
      const cart = loadCart();
      const q = Math.max(1, parseInt(val) || 1);
      cart[i].qty = q;
      saveCart(cart);
      renderCart();
    }

    function removeItem(i){
      const cart = loadCart();
      cart.splice(i,1);
      saveCart(cart);
      renderCart();
    }

    function clearCart(){
      if(!confirm('Clear all items from cart?')) return;
      localStorage.removeItem(CART_KEY);
      renderCart();
    }

    function placeOrder(){
      const cart = loadCart();
      if(cart.length===0){ alert('Cart is empty.'); return; }
      // create an order object to pass to payment page
      const order = {
        id: 'ORD' + Date.now(),
        items: cart,
        total: cart.reduce((s,i)=> s + ( (i.qty||1) * parseFloat(i.cost) ), 0)
      };
      localStorage.setItem('current_order', JSON.stringify(order));
      // go to payment page
      window.location.href = 'payment.html';
    }

    function goBack(){ window.location.href = 'menu.html'; }

    // initialize
    renderCart();
  </script>
</body>
</html>
